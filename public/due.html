<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>DJ TOTY GEE LIVE</title>
    <meta name="description" content="VR DJ Stage — A-Frame" />

    <!-- ✅ Use A-Frame version compatible with all components -->
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>

    <!-- ✅ A-Frame ecosystem components -->
    <script src="https://cdn.jsdelivr.net/gh/ngokevin/aframe-event-set-component@master/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.3/dist/super-hands.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://unpkg.com/aframe-randomizer-components@3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>

    <!-- ❌ Disabled networking for now (re-enable when EasyRTC server runs) -->
    <!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.5.0/socket.io.slim.js"></script>
    <script src="/easyrtc/easyrtc.js"></script>
    <script src="https://unpkg.com/networked-aframe@^0.12.0/dist/networked-aframe.min.js"></script>
    -->

    <!-- ✅ Inline replacement for missing spawn-in-circle.component.js -->
    <script>
      AFRAME.registerComponent("spawn-in-circle", {
        schema: { radius: { type: "number", default: 3 } },
        init: function () {
          const radius = this.data.radius;
          const angle = Math.random() * Math.PI * 2;
          const x = radius * Math.cos(angle);
          const z = radius * Math.sin(angle);
          this.el.setAttribute("position", { x, y: 1.7, z });
        },
      });
    </script>
  </head>

  <body style="background-color: black;">
    <a-scene>
      <a-assets>
        <img
          id="rug"
          crossorigin="anonymous"
          src="https://dragossido.github.io/public/assets/dj_toty_gee_3.png"
        />
        <video
          id="penguin-sledding"
          autoplay
          loop="true"
          crossorigin="anonymous"
          src="https://dragossido.github.io/public/assets/intro_vr.mp4"
        ></video>

        <a-asset-item
          id="speaker"
          crossorigin="anonymous"
          src="https://dragossido.github.io/public/assets/speaker.gltf"
        ></a-asset-item>
        <a-asset-item
          id="trusse"
          crossorigin="anonymous"
          src="https://dragossido.github.io/public/assets/trusse.gltf"
        ></a-asset-item>
        <a-asset-item
          id="movinghead"
          crossorigin="anonymous"
          src="https://dragossido.github.io/public/assets/movinghead.gltf"
        ></a-asset-item>
        <a-asset-item
          id="spk_floor"
          crossorigin="anonymous"
          src="https://dragossido.github.io/public/assets/spk_floor.gltf"
        ></a-asset-item>

        <!-- Avatar template (kept for future networking) -->
        <template id="avatar-template">
          <a-entity class="avatar">
            <a-sphere class="head" scale="0.45 0.5 0.4"></a-sphere>
            <a-entity class="face" position="0 0.05 0">
              <a-sphere
                class="eye"
                color="#efefef"
                position="0.16 0.1 -0.35"
                scale="0.12 0.12 0.12"
              >
                <a-sphere
                  class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
              <a-sphere
                class="eye"
                color="#efefef"
                position="-0.16 0.1 -0.35"
                scale="0.12 0.12 0.12"
              >
                <a-sphere
                  class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
            </a-entity>
          </a-entity>
        </template>
      </a-assets>

      <!-- ✅ Player -->
      <a-entity
        id="player"
        camera
        spawn-in-circle="radius:3"
        wasd-controls
        look-controls
      >
        <a-sphere class="head" visible="false" random-color></a-sphere>
      </a-entity>

      <!-- ✅ Floor -->
      <a-entity
        position="0 0 0"
        geometry="primitive: plane; width: 10000; height: 10000;"
        rotation="-90 0 0"
        material="src: #rug; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4;"
      ></a-entity>

      <!-- ✅ Stage -->
      <a-box
        position="0 2.5 -50"
        width="18"
        height="5"
        depth="2"
        color="red"
      ></a-box>

      <!-- ✅ Video Wall -->
      <a-plane
        position="0 9.65 -50"
        width="16"
        height="9"
        material="src:#penguin-sledding;"
      ></a-plane>

      <!-- ✅ Speakers (left + right) -->
      <a-entity
        gltf-model="#spk_floor"
        position="11 6 -50"
        rotation="0 0 180"
        scale="0.08 0.08 0.08"
      ></a-entity>
      <a-entity
        gltf-model="#spk_floor"
        position="14 6 -50"
        rotation="0 0 180"
        scale="0.08 0.08 0.08"
      ></a-entity>
      <a-entity
        gltf-model="#spk_floor"
        position="17 6 -50"
        rotation="0 0 180"
        scale="0.08 0.08 0.08"
      ></a-entity>

      <a-entity
        gltf-model="#spk_floor"
        position="-11 6 -50"
        rotation="0 0 180"
        scale="0.08 0.08 0.08"
      ></a-entity>
      <a-entity
        gltf-model="#spk_floor"
        position="-14 6 -50"
        rotation="0 0 180"
        scale="0.08 0.08 0.08"
      ></a-entity>
      <a-entity
        gltf-model="#spk_floor"
        position="-17 6 -50"
        rotation="0 0 180"
        scale="0.08 0.08 0.08"
      ></a-entity>

      <!-- ✅ Top Speakers + Trusses -->
      <a-entity gltf-model="#speaker" position="-11 14 -50" rotation="0 180 0"></a-entity>
      <a-entity gltf-model="#speaker" position="14 14 -50" rotation="0 180 0"></a-entity>

      <a-entity gltf-model="#trusse" position="-20 18 -50" scale="0.1 0.1 0.1"></a-entity>
      <a-entity gltf-model="#trusse" position="-10 18 -50" scale="0.1 0.1 0.1"></a-entity>
      <a-entity gltf-model="#trusse" position="0 18 -50" scale="0.1 0.1 0.1"></a-entity>
      <a-entity gltf-model="#trusse" position="10 18 -50" scale="0.1 0.1 0.1"></a-entity>
      <a-entity gltf-model="#trusse" position="20 18 -50" scale="0.1 0.1 0.1"></a-entity>

      <!-- ✅ Side trusses -->
      <a-entity
        gltf-model="#trusse"
        position="23 16 -50"
        rotation="0 0 90"
        scale="0.1 0.1 0.1"
      ></a-entity>
      <a-entity
        gltf-model="#trusse"
        position="23 6 -50"
        rotation="0 0 90"
        scale="0.1 0.1 0.1"
      ></a-entity>
      <a-entity
        gltf-model="#trusse"
        position="-23 16 -50"
        rotation="0 0 90"
        scale="0.1 0.1 0.1"
      ></a-entity>
      <a-entity
        gltf-model="#trusse"
        position="-23 6 -50"
        rotation="0 0 90"
        scale="0.1 0.1 0.1"
      ></a-entity>

      <!-- ✅ Moving lights -->
      <a-entity gltf-model="#movinghead" position="-17 15.7 -49" rotation="0 0 180"></a-entity>
      <a-entity gltf-model="#movinghead" position="-20 15.7 -49" rotation="0 0 180"></a-entity>
      <a-entity gltf-model="#movinghead" position="17 15.7 -49" rotation="0 0 180"></a-entity>
      <a-entity gltf-model="#movinghead" position="20 15.7 -49" rotation="0 0 180"></a-entity>

      <!-- ✅ Environment -->
      <a-sky color="#2f2c2c"></a-sky>
      <a-entity id="particles" particle-system="preset: snow"></a-entity>
    </a-scene>
  </body>
</html>
